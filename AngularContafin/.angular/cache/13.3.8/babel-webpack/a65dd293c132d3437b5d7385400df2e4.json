{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\User\\\\IdeaProjects\\\\contafin\\\\AngularContafin\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\classCallCheck.js\";\nimport _createClass from \"C:\\\\Users\\\\User\\\\IdeaProjects\\\\contafin\\\\AngularContafin\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\createClass.js\";\nimport { ElementRef } from '@angular/core';\nimport { Router } from \"@angular/router\";\nimport { NgbModal, ModalDismissReasons } from '@ng-bootstrap/ng-bootstrap';\nimport { UserService } from '../user.service';\nimport { LoginService } from '../../login/login.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../login/login.service\";\nimport * as i3 from \"../user.service\";\nimport * as i4 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i5 from \"../../navbar/navbar.component\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nvar _c0 = [\"newPass\"];\nvar _c1 = [\"oldPass\"];\n\nfunction UserConfigurationComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"div\", 26)(2, \"strong\");\n    i0.ɵɵtext(3, \"\\xA1Error al guardar los cambios!\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    var ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.errorMessage, \" \");\n  }\n}\n\nfunction UserConfigurationComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"div\", 27)(2, \"strong\");\n    i0.ɵɵtext(3, \"\\xA1Tus cambios se han guardado correctamente!\");\n    i0.ɵɵelementEnd()()();\n  }\n}\n\nfunction UserConfigurationComponent_h1_65_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"h1\", 22)(1, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function UserConfigurationComponent_h1_65_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r8);\n      var ctx_r7 = i0.ɵɵnextContext();\n\n      var _r5 = i0.ɵɵreference(67);\n\n      return ctx_r7.open(_r5);\n    });\n    i0.ɵɵtext(2, \" Eliminar cuenta \");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction UserConfigurationComponent_ng_template_66_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"form\")(1, \"div\", 29)(2, \"div\", 30)(3, \"div\", 31)(4, \"h3\", 32)(5, \"strong\");\n    i0.ɵɵtext(6, \"\\xBFEst\\xE1s seguro?\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(7, \"button\", 33)(8, \"span\", 34);\n    i0.ɵɵlistener(\"click\", function UserConfigurationComponent_ng_template_66_Template_span_click_8_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r12);\n      var d_r10 = restoredCtx.dismiss;\n      return d_r10(\"Cross click\");\n    });\n    i0.ɵɵtext(9, \"\\xD7\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(10, \"div\", 35)(11, \"div\", 36)(12, \"h6\", 32);\n    i0.ɵɵtext(13, \"Se borrara tu progreso.\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"div\", 37)(15, \"a\", 38);\n    i0.ɵɵlistener(\"click\", function UserConfigurationComponent_ng_template_66_Template_a_click_15_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r12);\n      var d_r10 = restoredCtx.dismiss;\n      return d_r10(\"Cross click\");\n    });\n    i0.ɵɵtext(16, \"CANCELAR\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"input\", 39);\n    i0.ɵɵlistener(\"click\", function UserConfigurationComponent_ng_template_66_Template_input_click_17_listener() {\n      i0.ɵɵrestoreView(_r12);\n      var ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.deleteAccount();\n    })(\"click\", function UserConfigurationComponent_ng_template_66_Template_input_click_17_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r12);\n      var d_r10 = restoredCtx.dismiss;\n      return d_r10(\"Cross click\");\n    });\n    i0.ɵɵelementEnd()()()();\n  }\n}\n\nexport var UserConfigurationComponent = /*#__PURE__*/(function () {\n  var UserConfigurationComponent = /*#__PURE__*/function () {\n    function UserConfigurationComponent(router, loginService, userService, modalService) {\n      _classCallCheck(this, UserConfigurationComponent);\n\n      this.router = router;\n      this.loginService = loginService;\n      this.userService = userService;\n      this.modalService = modalService;\n      this.errorMessage = \"\";\n      this.alertDanger = false;\n      this.alertSuccess = false;\n      this.userData = {\n        name: \"\",\n        email: \"\",\n        passwordHash: \"\"\n      };\n    }\n\n    _createClass(UserConfigurationComponent, [{\n      key: \"ngOnInit\",\n      value: function ngOnInit() {\n        this.loggedUser = this.loginService.getLoggedUser();\n        this.noAdmin = !this.loginService.isAdministrator();\n        this.userService.getUser(this.loggedUser.id);\n      } //Other methods\n\n    }, {\n      key: \"updateUser\",\n      value: function updateUser() {\n        var _this = this;\n\n        this.alertDanger = false;\n        this.alertSuccess = false;\n\n        if (this.oldPassInput.nativeElement.value != null) {\n          this.userService.validation(this.loggedUser.id, this.oldPassInput.nativeElement.value).subscribe(function (validation) {\n            _this.rightPass = validation;\n            console.log(_this.rightPass);\n\n            _this.getPasswords();\n\n            _this.loadChanges();\n          }, function (error) {\n            return console.log(error);\n          });\n        }\n      }\n    }, {\n      key: \"getPasswords\",\n      value: function getPasswords() {\n        this.userData.passwordHash = this.newPassInput.nativeElement.value;\n        this.oldPassInput.nativeElement.value = '';\n        this.newPassInput.nativeElement.value = '';\n      } //If the current password is right, save the changes\n\n    }, {\n      key: \"loadChanges\",\n      value: function loadChanges() {\n        var _this2 = this;\n\n        if (this.rightPass) {\n          this.userService.updateUser(this.loggedUser.id, this.userData).subscribe(function (user) {\n            _this2.loggedUser.name = user.name;\n            _this2.loggedUser.email = user.email;\n            _this2.loggedUser.passwordHash = user.passwordHash;\n            _this2.loggedUser = _this2.loginService.getLoggedUser();\n            _this2.alertSuccess = true;\n\n            _this2.router.navigate(['/User/Configuration']);\n          }, function (error) {\n            _this2.errorMessage = \"No has introducido ningún cambio.\";\n            _this2.alertDanger = true;\n          });\n        } else {\n          this.errorMessage = \"Contraseña incorrecta.\";\n          this.alertDanger = true;\n        }\n\n        this.userData = {\n          name: \"\",\n          email: \"\",\n          passwordHash: \"\"\n        };\n      } //Load image\n\n    }, {\n      key: \"selectFile\",\n      value: function selectFile(event) {\n        var file = event.target.files;\n        this.image = new FormData();\n        this.image.append('file', file[0]);\n      } //Save image\n\n    }, {\n      key: \"uploadImage\",\n      value: function uploadImage() {\n        var _this3 = this;\n\n        this.alertDanger = false;\n        this.alertSuccess = false;\n\n        if (this.image) {\n          this.userService.uploadImage(this.loggedUser.id, this.image).subscribe(function (response) {\n            _this3.loggedUser = _this3.loginService.getLoggedUser();\n            _this3.loggedUser.imgURL = \"https://localhost:8080/api/User/Photo?a\" + new Date().getTime();\n\n            _this3.router.navigate(['/User/Configuration']);\n          }, function (error) {\n            return console.error('Error al subir la imagen:' + error);\n          });\n          this.image = null;\n          this.alertDanger = false;\n        } else {\n          this.errorMessage = \"No has seleccionado ninguna imagen.\";\n          this.alertDanger = true;\n        }\n      }\n    }, {\n      key: \"deleteAccount\",\n      value: function deleteAccount() {\n        var _this4 = this;\n\n        this.userService.deleteAccount(this.loggedUser.id).subscribe(function (response) {\n          _this4.loginService.isLogged = false;\n          _this4.loginService.isAdmin = false;\n\n          _this4.router.navigate(['/']);\n        }, function (error) {\n          return console.log(\"Error al borrar el usuario\");\n        });\n      }\n    }, {\n      key: \"open\",\n      value: function open(content) {\n        var _this5 = this;\n\n        this.modalService.open(content).result.then(function (result) {\n          _this5.closeResult = \"Closed with: \".concat(result);\n        }, function (reason) {\n          _this5.closeResult = \"Dismissed \".concat(_this5.getDismissReason(reason));\n        });\n      }\n    }, {\n      key: \"getDismissReason\",\n      value: function getDismissReason(reason) {\n        if (reason === ModalDismissReasons.ESC) {\n          return 'by pressing ESC';\n        } else if (reason === ModalDismissReasons.BACKDROP_CLICK) {\n          return 'by clicking on a backdrop';\n        } else {\n          return \"with: \".concat(reason);\n        }\n      }\n    }]);\n\n    return UserConfigurationComponent;\n  }();\n\n  UserConfigurationComponent.ɵfac = function UserConfigurationComponent_Factory(t) {\n    return new (t || UserConfigurationComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.LoginService), i0.ɵɵdirectiveInject(i3.UserService), i0.ɵɵdirectiveInject(i4.NgbModal));\n  };\n\n  UserConfigurationComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UserConfigurationComponent,\n    selectors: [[\"app-user-configuration\"]],\n    viewQuery: function UserConfigurationComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 5);\n      }\n\n      if (rf & 2) {\n        var _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.newPassInput = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.oldPassInput = _t.first);\n      }\n    },\n    decls: 68,\n    vars: 9,\n    consts: [[1, \"mt-4\"], [1, \"container\", \"my-auto\"], [1, \"row\"], [1, \"col-sm-12\"], [1, \"col-sm-8\"], [\"id\", \"round\", 1, \"mt-5\", \"mx-auto\", \"text-center\", \"card-body\", \"bg-white\", \"card\"], [1, \"container\"], [\"class\", \"container\", 4, \"ngIf\"], [\"ngNativeValidate\", \"\"], [1, \"col-sm-8\", \"mt-5\"], [1, \"col-sm-3\", \"mt-5\"], [\"type\", \"submit\", \"value\", \"Guardar cambios\", 1, \"btn\", \"btn-primary\", \"js-scroll-trigger\", 3, \"click\"], [\"type\", \"text\", \"id\", \"roundregister\", \"name\", \"newName\", 1, \"form-control\", 3, \"ngModel\", \"placeholder\", \"ngModelChange\"], [\"type\", \"email\", \"id\", \"roundregister\", \"aria-describedby\", \"emailHelp\", \"name\", \"newEmail\", 1, \"form-control\", 3, \"ngModel\", \"placeholder\", \"ngModelChange\"], [\"type\", \"password\", \"id\", \"roundregister\", \"name\", \"newPass\", \"placeholder\", \"Nueva contrase\\xF1a\", 1, \"form-control\"], [\"newPass\", \"\"], [\"required\", \"\", \"minlength\", \"1\", \"type\", \"password\", \"id\", \"roundregister\", \"name\", \"newPass\", \"placeholder\", \"Antigua contrase\\xF1a\", 1, \"form-control\"], [\"oldPass\", \"\"], [\"enctype\", \"multipart/form-data\"], [\"file-model\", \"file\", \"id\", \"inputTipe\", \"type\", \"file\", \"name\", \"file\", \"multiple\", \"\", 1, \"text-center\", \"text-secondary\", 3, \"change\"], [\"type\", \"submit\", \"id\", \"button-style\", \"value\", \"Enviar\", 1, \"btn\", \"btn-primary\", \"js-scroll-trigger\", \"mt-2\", 3, \"click\"], [1, \"col-sm-4\"], [1, \"card-header\", \"bg-white\"], [\"width\", \"90\", \"height\", \"35\", \"id\", \"round\", 1, \"img-thumbnail\", 3, \"src\"], [\"class\", \"card-header bg-white\", 4, \"ngIf\"], [\"content\", \"\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\", \"mt-2\"], [\"role\", \"alert\", 1, \"alert\", \"alert-success\", \"mt-2\"], [\"id\", \"button-style\", \"type\", \"button\", \"data-toggle\", \"modal\", \"data-target\", \"#exampleModalLong\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"modal-content\"], [1, \"modal-header\"], [1, \"col-8\"], [\"id\", \"exampleModalLongTitle\", 1, \"modal-title\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"close\"], [\"aria-hidden\", \"true\", 3, \"click\"], [1, \"modal-body\"], [1, \"col-12\"], [1, \"modal-footer\"], [\"data-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"btn\", \"btn-primary\", \"text-white\", 3, \"click\"], [\"type\", \"submit\", \"value\", \"Borrar cuenta\", \"id\", \"button-style\", 1, \"btn\", \"btn-primary\", 3, \"click\"]],\n    template: function UserConfigurationComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"app-navbar\");\n        i0.ɵɵelementStart(1, \"div\", 0)(2, \"div\", 1)(3, \"div\", 2)(4, \"div\", 3)(5, \"div\", 2)(6, \"div\", 4)(7, \"div\", 5)(8, \"div\", 6);\n        i0.ɵɵtemplate(9, UserConfigurationComponent_div_9_Template, 5, 1, \"div\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"div\", 6);\n        i0.ɵɵtemplate(11, UserConfigurationComponent_div_11_Template, 4, 0, \"div\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"form\", 8)(13, \"div\", 2)(14, \"div\", 9)(15, \"h3\");\n        i0.ɵɵtext(16, \"Configuraci\\xF3n de la cuenta\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(17, \"div\", 10)(18, \"input\", 11);\n        i0.ɵɵlistener(\"click\", function UserConfigurationComponent_Template_input_click_18_listener() {\n          return ctx.updateUser();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(19, \"br\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(20, \"div\", 2)(21, \"div\", 10)(22, \"h5\");\n        i0.ɵɵtext(23, \"Usuario:\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(24, \"div\", 9)(25, \"h5\")(26, \"input\", 12);\n        i0.ɵɵlistener(\"ngModelChange\", function UserConfigurationComponent_Template_input_ngModelChange_26_listener($event) {\n          return ctx.userData.name = $event;\n        });\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(27, \"div\", 2)(28, \"div\", 10)(29, \"h5\");\n        i0.ɵɵtext(30, \"Correo:\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(31, \"div\", 9)(32, \"h5\")(33, \"input\", 13);\n        i0.ɵɵlistener(\"ngModelChange\", function UserConfigurationComponent_Template_input_ngModelChange_33_listener($event) {\n          return ctx.userData.email = $event;\n        });\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(34, \"div\", 2)(35, \"div\", 10)(36, \"h5\");\n        i0.ɵɵtext(37, \"Nueva contrase\\xF1a:\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(38, \"div\", 9)(39, \"h5\");\n        i0.ɵɵelement(40, \"input\", 14, 15);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(42, \"div\", 2)(43, \"div\", 10)(44, \"h5\");\n        i0.ɵɵtext(45, \"Antigua contrase\\xF1a:\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(46, \"div\", 9)(47, \"h5\");\n        i0.ɵɵelement(48, \"input\", 16, 17);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(50, \"form\", 18)(51, \"div\", 2)(52, \"div\", 10)(53, \"h5\");\n        i0.ɵɵtext(54, \"Imagen:\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(55, \"div\", 9)(56, \"h6\")(57, \"input\", 19);\n        i0.ɵɵlistener(\"change\", function UserConfigurationComponent_Template_input_change_57_listener($event) {\n          return ctx.selectFile($event);\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(58, \"h5\")(59, \"input\", 20);\n        i0.ɵɵlistener(\"click\", function UserConfigurationComponent_Template_input_click_59_listener() {\n          return ctx.uploadImage();\n        });\n        i0.ɵɵelementEnd()()()()()()();\n        i0.ɵɵelementStart(60, \"div\", 21)(61, \"div\", 5)(62, \"h1\", 22);\n        i0.ɵɵelement(63, \"img\", 23);\n        i0.ɵɵtext(64);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(65, UserConfigurationComponent_h1_65_Template, 3, 0, \"h1\", 24);\n        i0.ɵɵelementEnd()()()()()()();\n        i0.ɵɵtemplate(66, UserConfigurationComponent_ng_template_66_Template, 18, 0, \"ng-template\", null, 25, i0.ɵɵtemplateRefExtractor);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngIf\", ctx.alertDanger);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.alertSuccess);\n        i0.ɵɵadvance(15);\n        i0.ɵɵproperty(\"ngModel\", ctx.userData.name)(\"placeholder\", ctx.loggedUser.name);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngModel\", ctx.userData.email)(\"placeholder\", ctx.loggedUser.email);\n        i0.ɵɵadvance(30);\n        i0.ɵɵproperty(\"src\", ctx.loggedUser.imgURL, i0.ɵɵsanitizeUrl);\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate1(\" \", ctx.loggedUser.name, \" \");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.noAdmin);\n      }\n    },\n    directives: [i5.NavBarComponent, i6.NgIf, i7.NgControlStatusGroup, i7.NgForm, i7.DefaultValueAccessor, i7.NgControlStatus, i7.NgModel, i7.ɵNgNoValidate],\n    styles: [\"\"]\n  });\n  return UserConfigurationComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}